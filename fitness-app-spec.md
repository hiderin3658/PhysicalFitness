# 体力測定アプリケーション 詳細設計書

## 1. 概要

高齢者の体力測定データを記録・管理・分析するためのWebアプリケーション。測定結果を時系列で表示し、視覚的にトレンドを確認できる機能を提供します。

## 2. 技術スタック

- **フロントエンド**: Next.js (App Router)
- **バックエンド**: Next.js API Routes
- **データベース**: Upstash Redis
- **デプロイ**: Vercel
- **スタイリング**: CSS Modules / Tailwind CSS

## 3. 機能要件

### 3.1 ユーザー管理機能

- ユーザー一覧表示
- ユーザー情報の登録・編集
  - 姓、名
  - 性別
  - 生年月日
  - 既往歴

### 3.2 体力測定データ管理機能

- 測定データの入力
  - 測定日
  - 身長
  - 体重
  - TUG（1回目・2回目）※高い値のみ保存
  - 5m歩行（1回目・2回目）※高い値のみ保存
  - FR（1回目・2回目）
  - CS10 ※高い値のみ保存
  - 備考
- 測定データの一覧表示
- BI値の追加入力

### 3.3 データ可視化機能

- 測定結果の時系列表示（最大4件）
  - 最新のデータを右端に表示
  - 新しい順に右から左へ並べる
  - データが3つ以下の場合は左詰めで表示
- 測定値の推移をグラフ表示

## 4. 画面設計

### 4.1 ユーザー一覧ページ

- 登録済みユーザー（氏名）の一覧を表示
- 各ユーザーに対して以下のアクションボタンを表示
  - 編集ボタン：ユーザー情報編集ページへ遷移
  - データ一覧ボタン：ユーザーの測定データ一覧ページへ遷移
- 新規ユーザー追加ボタン

### 4.2 ユーザー情報編集ページ

- 以下の情報を編集可能
  - 姓、名
  - 性別
  - 生年月日
  - 既往歴
- 保存ボタン
- キャンセルボタン（ユーザー一覧ページへ戻る）

### 4.3 体力測定入力ページ

- フォーム形式で以下の項目を入力
  - 測定日（デフォルト：現在日付）
  - 身長
  - 体重
  - TUG（1回目・2回目）
  - 5m歩行（1回目・2回目）
  - FR（1回目・2回目）
  - CS10
  - 備考
- 送信ボタン
- クリアボタン

### 4.4 測定データ一覧ページ

- ユーザーの基本情報を表示
  - 氏名
  - 性別
  - 生年月日
  - 既往歴
- 過去の測定データをテーブル形式で表示
- 各データに対して編集ボタン
- BI値の入力・編集機能
- 評価結果表示ページへのリンク

### 4.5 評価結果表示ページ

- ユーザーの基本情報を表示
  - 氏名
  - 性別
  - 生年月日
  - 既往歴
- 評価結果を表形式で表示（最大4件）
  - 日付
  - 身長
  - 体重
  - BMI（自動計算）
  - TUG
  - 5m歩行
  - FR
  - CS10
  - BI
  - 備考
- 各測定値の推移をグラフ表示
- 「体力測定からの評価」セクション

## 5. データモデル

### 5.1 ユーザーデータ

```json
{
  "id": "ユニークID",
  "lastName": "姓",
  "firstName": "名",
  "gender": "性別",
  "birthDate": "生年月日",
  "medicalHistory": "既往歴",
  "createdAt": "作成日時",
  "updatedAt": "更新日時"
}
```

### 5.2 測定データ

```json
{
  "id": "ユニークID",
  "userId": "ユーザーID",
  "measurementDate": "測定日",
  "height": "身長",
  "weight": "体重",
  "tug": {
    "first": "1回目の値",
    "second": "2回目の値",
    "best": "ベスト値（高い方）"
  },
  "walkingSpeed": {
    "first": "1回目の値",
    "second": "2回目の値",
    "best": "ベスト値（高い方）"
  },
  "fr": {
    "first": "1回目の値",
    "second": "2回目の値",
    "best": "ベスト値（高い方）"
  },
  "cs10": "CS10値",
  "bi": "BI値",
  "notes": "備考",
  "createdAt": "作成日時",
  "updatedAt": "更新日時"
}
```

## 6. API設計

### 6.1 ユーザー関連API

| エンドポイント | メソッド | 説明 |
|--------------|--------|------|
| `/api/users` | GET | ユーザー一覧の取得 |
| `/api/users` | POST | 新規ユーザーの作成 |
| `/api/users/:id` | GET | 特定ユーザーの取得 |
| `/api/users/:id` | PUT | ユーザー情報の更新 |
| `/api/users/:id` | DELETE | ユーザーの削除 |

### 6.2 測定データ関連API

| エンドポイント | メソッド | 説明 |
|--------------|--------|------|
| `/api/measurements` | POST | 新規測定データの登録 |
| `/api/measurements/:id` | PUT | 測定データの更新 |
| `/api/measurements/:id` | DELETE | 測定データの削除 |
| `/api/users/:userId/measurements` | GET | 特定ユーザーの全測定データ取得 |
| `/api/users/:userId/measurements/latest` | GET | 特定ユーザーの最新4件の測定データ取得 |

## 7. ディレクトリ構造

```
fitness-tracker/
├── public/
│   └── favicon.ico
├── src/
│   ├── app/
│   │   ├── page.js                  # ホームページ（ユーザー一覧）
│   │   ├── layout.js                # レイアウトコンポーネント
│   │   ├── globals.css              # グローバルスタイル
│   │   ├── measurement/             # 測定入力ページ
│   │   │   ├── page.js
│   │   │   └── [id]/
│   │   │       └── page.js          # 特定ユーザーの測定入力
│   │   ├── user/                    # ユーザー関連ページ
│   │   │   ├── edit/
│   │   │   │   └── [id]/
│   │   │   │       └── page.js      # ユーザー編集ページ
│   │   │   └── create/
│   │   │       └── page.js          # ユーザー作成ページ
│   │   └── result/                  # 結果表示ページ
│   │       └── [id]/
│   │           └── page.js          # 特定ユーザーの結果
│   ├── components/                  # 共通コンポーネント
│   │   ├── UserList.js              # ユーザー一覧コンポーネント
│   │   ├── MeasurementForm.js       # 測定フォームコンポーネント
│   │   ├── ResultTable.js           # 結果表示テーブル
│   │   └── ResultChart.js           # 結果グラフ表示
│   ├── lib/                         # ユーティリティ関数
│   │   ├── db.js                    # Upstash Redis クライアント
│   │   └── utils.js                 # 共通ユーティリティ
│   └── api/                         # APIルート
│       ├── users/                   # ユーザー関連API
│       │   ├── route.js
│       │   └── [id]/
│       │       └── route.js
│       └── measurements/            # 測定データ関連API
│           ├── route.js
│           └── [id]/
│               └── route.js
├── package.json
├── next.config.js
└── .env.local                       # 環境変数（Upstash接続情報など）
```

## 8. デプロイ方法

1. GitHub リポジトリにコードをプッシュ
2. Vercel との連携設定
3. 環境変数の設定（Upstash Redis 接続情報）
4. デプロイ実行

## 9. データベース設計（Upstash Redis）

Upstash Redis では、キー・バリュー形式でデータを保存します。

### 9.1 ユーザーデータ

- キー形式: `user:{id}`
- 値: ユーザー情報のJSONオブジェクト

### 9.2 測定データ

- キー形式: `measurement:{id}`
- 値: 測定データのJSONオブジェクト

### 9.3 インデックス

- ユーザー一覧: `users` (Set型でユーザーIDを保存)
- ユーザー別測定データ: `user:{userId}:measurements` (Sorted Set型で測定日時順にID保存)

## 10. 拡張性と将来の検討事項

1. 認証機能の追加（医療関係者向けログイン）
2. データのエクスポート機能（CSV、PDF）
3. より詳細な統計分析機能
4. 複数施設でのデータ共有機能
5. モバイルアプリ対応

## 11. 開発スケジュール

1. 環境構築・プロジェクト準備（1日）
2. ユーザー管理機能実装（2日）
3. 測定データ入力機能実装（2日）
4. データ表示・グラフ機能実装（3日）
5. UI/UX調整・スタイリング（2日）
6. テスト・バグ修正（2日）
7. デプロイ・動作確認（1日）

総工数: 約2週間
